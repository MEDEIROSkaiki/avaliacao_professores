{% extends 'base.html' %}

{% block content %}

<style>
    /* ==============================================
  CSS PARA O RANKING (ADMIN E ALUNO)
  ==============================================
  */

    .ranking-wrapper {
        /* Usa o mesmo layout do admin, mas sem o painel lateral */
        width: 90%;
        max-width: 1200px;
        margin: 40px auto;
        flex-grow: 1;
    }

    .ranking-header {
        text-align: center;
        margin-bottom: 40px;
    }

    .ranking-header h1 {
        color: var(--azul-marinho);
        font-size: 2rem;
        font-weight: 700;
    }

    .ranking-header h2 {
        color: var(--verde-escuro-letras);
        font-weight: 500;
    }

    /* ---------------------------------
  VISUALIZAÇÃO DO ALUNO (CARDS)
  ---------------------------------
  */
    .student-ranking-container {
        display: flex;
        /* A CORREÇÃO PRINCIPAL ESTÁ AQUI: 
      flex-wrap: wrap; garante que os cards quebrem a linha 
      em telas menores ou se forem muitos.
    */
        flex-wrap: wrap;
        justify-content: center;
        gap: 25px;
        padding: 0;
    }

    .student-rank-card {
        background-color: #fff;
        border-radius: 12px;
        padding: 30px;
        text-align: center;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.07);
        border: 1px solid var(--painel-central);

        /* --- MUDANÇAS AQUI --- */
        /* Em vez de 'width: 280px;', usamos flexbox: */
        flex: 1;
        /* Faz o card ser flexível (crescer/diminuir) */
        max-width: 215px;
        /* Largura MÁXIMA (5 cabem na tela de 1200px) */
        min-width: 200px;
        /* Largura MÍNIMA antes de quebrar a linha */
        /* --- FIM DA MUDANÇA --- */

        display: flex;
        flex-direction: column;
        align-items: center;
        transition: transform 0.3s ease, box-shadow 0.3s ease;
    }

    .student-rank-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
    }

    /* O NÚMERO DO RANKING (1, 2, 3...) */
    .rank-number {
        font-size: 3.5rem;
        font-weight: 700;
        color: var(--verde);
        line-height: 1;
    }

    /* O '°' (símbolo de ordinal) */
    .rank-number sup {
        font-size: 1.5rem;
        font-weight: 600;
        top: -1.2em;
        /* Ajusta a altura do símbolo */
    }

    .card-foto-rank {
        width: 100px;
        height: 100px;
        border-radius: 50%;
        margin: 15px auto;
        background-color: var(--painel-central);
        display: flex;
        align-items: center;
        justify-content: center;
        color: var(--azul-acinzentado);
        font-size: 3.5rem;
        border: 4px solid var(--painel-central);
    }

    .card-foto-rank img {
        width: 100%;
        height: 100%;
        object-fit: cover;
        border-radius: 50%;
    }

    .rank-prof-name {
        font-size: 1.25rem;
        color: var(--azul-marinho);
        font-weight: 600;
        margin-bottom: 5px;
    }

    .rank-disciplina {
        font-size: 0.9rem;
        color: var(--verde-escuro-letras);
        margin-bottom: 20px;
        display: block;
        min-height: 2.5em;
        /* Garante altura mesmo se o nome for curto */
    }

    /* Botão (reaproveita a classe .btn de base.html) */
    .btn-ver-perfil {
        margin-top: auto;
        /* Empurra o botão para o fim do card */
        padding: 12px 20px;
        border: none;
        border-radius: 8px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        font-size: 0.95rem;
        color: #fff;
        background-color: var(--verde);
        text-align: center;
        width: 100%;
    }

    .btn-ver-perfil:hover {
        opacity: 0.85;
        transform: translateY(-2px);
    }

    /* ---------------------------------
  VISUALIZAÇÃO DO ADMIN (TABELA)
  ---------------------------------
  */
    .admin-ranking-panel {
        /* Reutiliza o estilo do painel de admin */
        flex-basis: 100%;
        max-width: 1000px;
        background-color: #fff;
        border-radius: 12px;
        padding: 30px;
        box-shadow: 0 2px 12px rgba(0, 0, 0, 0.08);
        margin: 0 auto;
        /* Centraliza o painel */
    }

    .admin-ranking-table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 20px;
    }

    .admin-ranking-table th,
    .admin-ranking-table td {
        padding: 15px;
        text-align: left;
        border-bottom: 1px solid var(--painel-central);
    }

    .admin-ranking-table th {
        background-color: #f8f9fa;
        /* Um cinza bem claro */
        color: var(--azul-marinho);
        font-size: 0.9rem;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }

    .admin-ranking-table td {
        color: var(--verde-escuro-letras);
        font-weight: 500;
    }

    .admin-ranking-table .rank-col {
        width: 10%;
        text-align: center;
        font-weight: 700;
        font-size: 1.1rem;
    }

    .admin-ranking-table .prof-col {
        width: 35%;
        color: var(--azul-marinho);
    }

    .admin-ranking-table .disc-col {
        width: 35%;
    }

    .admin-ranking-table .nota-col {
        width: 20%;
        font-weight: 700;
        color: var(--verde);
        font-size: 1.1rem;

        /* --- ADICIONE ESSAS DUAS LINHAS --- */
        white-space: nowrap;
        /* Impede a quebra de linha */
        text-align: center;
        /* Centraliza o texto (bônus) */
    }
</style>

<div class="ranking-wrapper">

    {% if request.user.is_staff %}
    <div class="admin-ranking-panel">
        <div class="ranking-header">
            <h1>Ranking de Avaliações (Admin)</h1>
            <h2>Top 10 melhores avaliações (por disciplina/professor)</h2>
        </div>

        <table class="admin-ranking-table">
            <thead>
                <tr>
                    <th class="rank-col">Rank</th>
                    <th class="prof-col">Professor</th>
                    <th class="disc-col">Disciplina</th>
                    <th class="nota-col">Média da Turma</th>
                </tr>
            </thead>
            <tbody>
                {% for dp in ranking_disciplinas %}
                <tr>
                    <td class="rank-col">#{{ forloop.counter }}</td>
                    <td class="prof-col">{{ dp.pessoa.get_full_name }}</td>
                    <td class="disc-col">{{ dp.disciplina.nome }}</td>
                    <td class="nota-col">{{ dp.media_nota|floatformat:2 }}</td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="4" style="text-align: center; padding: 30px;">
                        Ainda não há avaliações suficientes para gerar um ranking.
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    {% else %}
    <div class="ranking-header">
        <h1>Melhores Avaliados</h1>
        <h2>O Top 5 da universidade, segundo os alunos</h2>
    </div>

    <div class="student-ranking-container">
        {% for dp in ranking_disciplinas %}
        <div class="student-rank-card">
            <div class="card-foto-rank">
                {% if dp.pessoa.professor.foto %}
                <img src="{{ dp.pessoa.professor.foto.url }}" alt="Foto de {{ dp.pessoa.get_full_name }}">
                {% else %}
                <i class="fa-solid fa-user"></i>
                {% endif %}
            </div>

            <h4 class="rank-prof-name">{{ dp.pessoa.get_full_name|default:dp.pessoa.username }}</h4>
            <span class="rank-disciplina">{{ dp.disciplina.nome }}</span>

            <a href="{% url 'detalhes_professor' dp.pessoa.professor.id %}" class="btn-ver-perfil">
                Ver Perfil
            </a>
        </div>
        {% empty %}
        <p style="color: var(--verde-escuro-letras); font-size: 1.1rem;">
            Ainda não há avaliações suficientes para gerar um ranking.
        </p>
        {% endfor %}
    </div>
    {% endif %}

</div>

{% endblock content %}