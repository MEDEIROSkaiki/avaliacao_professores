{% extends 'base.html' %}
{% load static %}

{% block content %}

<main class="admin-container">

    <section class="admin-panel">
        <h1>Adicionar Novo Usuário</h1>

        <form action="" method="POST" enctype="multipart/form-data"> 
            {% csrf_token %}
            
            <div class="form-group">
                <select id="tipo_usuario" name="tipo_usuario">
                    <option value="" disabled selected>Selecione o Tipo de Usuário</option>
                    <option value="aluno">Aluno</option>
                    <option value="professor">Professor</option>
                    <option value="administrador">Administrador</option>
                </select>
            </div>
            
            <div class="form-group" id="campo_disciplina" style="display: none;">
                <select id="materia_disciplina" name="materia_disciplina">
                    <option value="" disabled selected>Selecione a Disciplina</option>
                    {% for materia in materias %}
                        <option value="{{ materia.id }}">{{ materia.nome }}</option>
                    {% endfor %}
                </select>
            </div>
            
            <div class="form-group">
                <input type="text" id="nome" name="nome" placeholder="Nome Completo">
            </div>
            
            <div class="form-group">
                <input type="email" id="email" name="email" placeholder="Email (login)">
            </div>
            
            <div class="form-group">
                <input type="text" id="cpf" name="cpf" placeholder="CPF (só números)">
            </div>
            
            <div class="form-group">
                <input type="text" id="nascimento" name="nascimento" placeholder="Data de Nascimento (DD/MM/AAAA)" maxlength="10">
            </div>

            <div class="form-group" id="campo_foto_perfil" style="display: none;">
                <label for="imagem_perfil" style="display: block; margin-bottom: 5px; font-weight: 500; color: var(--azul-marinho);">
                    Foto de Perfil (Opcional)
                </label>
                <input type="file" id="imagem_perfil" name="imagem_perfil" accept="image/*" style="
                    padding: 10px 0; 
                    background-color: transparent; 
                    border: none;
                    width: 100%;
                    box-sizing: border-box; 
                    color: var(--verde-escuro-letras);">
            </div>
            
            <div class="form-buttons">
                <button type="submit" class="btn">Cadastrar Usuário</button>
            </div>
        </form>
    </section>

</main>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        // --- 1. Lógica do Tipo de Usuário (Professor/Aluno) ---
        const tipoUsuarioSelect = document.getElementById('tipo_usuario');
        const campoDisciplinaDiv = document.getElementById('campo_disciplina');
        const campoFotoDiv = document.getElementById('campo_foto_perfil');

        tipoUsuarioSelect.addEventListener('change', function() {
            if (this.value === 'professor') {
                campoDisciplinaDiv.style.display = 'block';
                campoFotoDiv.style.display = 'block';
            } else {
                campoDisciplinaDiv.style.display = 'none';
                campoFotoDiv.style.display = 'none';
            }
        });

        // --- 2. Máscara de Data de Nascimento ---
        const nascimentoInput = document.getElementById('nascimento');

        nascimentoInput.addEventListener('input', function(e) {
            let value = e.target.value.replace(/\D/g, ''); // Remove tudo que não é número
            
            if (value.length > 2) {
                value = value.substring(0, 2) + '/' + value.substring(2);
            }
            if (value.length > 5) {
                value = value.substring(0, 5) + '/' + value.substring(5);
            }
            
            e.target.value = value;
        });
    });
</script>

{% endblock content %}